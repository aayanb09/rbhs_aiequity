{% extends "base.html" %}

{% block title %}Home{% endblock %}

{% block content %}
<div style="
    position: fixed;
    top: 75px; /* offset for the navbar height */
    left: 0;
    width: 100vw;
    height: calc(100vh - 75px);
    display: flex;
    justify-content: center;
    box-sizing: border-box;
    overflow: hidden;
">

    <div style="display: flex; justify-content: space-between; align-items: flex-start; width: 100%; max-width: 1400px; padding: 80px 60px 40px 60px;">

        <!-- Sidebar Navigation -->
        <div style="display: flex; flex-direction: column; align-items: flex-start; gap: 18px; width: 250px; align-self: flex-start;">
            <h2 style="color: #088502; margin-bottom: 10px;">Activities</h2>
            <a href="/symptomTracker" style="background: #088502; color: white; padding: 0.9em 1.5em; border-radius: 8px; text-decoration: none; font-size: 1.1em; width: 100%;">Track Symptoms</a>
            <a href="/reminders" style="background: #088502; color: white; padding: 0.9em 1.5em; border-radius: 8px; text-decoration: none; font-size: 1.1em; width: 100%;">Reminders</a>
            <a href="/upload" style="background: #088502; color: white; padding: 0.9em 1.5em; border-radius: 8px; text-decoration: none; font-size: 1.1em; width: 100%;">Upload Food</a>
        </div>

        <!-- Main Centered Section -->
        <div style="flex: 1; text-align: center; display: flex; flex-direction: column; justify-content: flex-start; align-items: center; gap: 20px;">
            <h1 style="font-size: 2.8em; margin: 0.2em 0; color: #088502;">RBHS Symptom Tracker</h1>
            <h2 style="font-weight: 400; color: #333; margin-bottom: 1em;">Your Health Management Dashboard</h2>
            <p style="max-width: 600px; color: #444; line-height: 1.6; margin: 0 auto 1.5em auto;">
                Welcome to your personalized health dashboard. Here, you can record symptoms, schedule reminders, upload medical records, and track your wellness progress ‚Äî all in one place.
            </p>
            <p style="margin-top: 2em; color: #666; font-size: 0.9em;">Developed by Henry, Opparam, and Rita</p>
            <p style="color:#888;">Test value: {{test_value}}</p>
        </div>

        <!-- Right Widgets -->
        <div style="display: flex; flex-direction: column; gap: 20px; width: 260px; align-self: flex-start;">

            <!-- Today's Symptoms Widget -->
            <div id="todaysSymptomsWidget" style="display: block; background: #f8fdf8; border-radius: 12px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); color: #222;">
                <h3 style="color: #088502; margin-bottom: 8px;">üìã Today's Symptoms</h3>
                <div id="todaysSymptomsContent" style="font-size: 0.95em; color: #555; line-height: 1.4;">
                    Loading...
                </div>
            </div>

            <!-- Today's Reminders Widget -->
            <div id="todaysRemindersWidget" style="display: block; background: #f8fdf8; border-radius: 12px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); color: #222;">
                <h3 style="color: #088502; margin-bottom: 8px;">‚è∞ Today's Reminders</h3>
                <div id="todaysRemindersContent" style="font-size: 0.95em; color: #555; line-height: 1.4;">
                    Loading...
                </div>
            </div>

        </div>

    </div>
</div>

<style>
    html, body {
        height: 100%;
        margin: 0;
        overflow: hidden;
        font-family: 'Inter', 'Segoe UI', Arial, sans-serif;
    }
    a:hover {
        background: #0a9e06;
        transform: translateX(5px);
    }
    .widget:hover {
        transform: scale(1.03);
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
</style>

<script>
// --- Utility Functions ---
function getTodayDate() {
    const t = new Date();
    return `${t.getFullYear()}-${String(t.getMonth() + 1).padStart(2,'0')}-${String(t.getDate()).padStart(2,'0')}`;
}

function loadSymptoms() {
    return JSON.parse(localStorage.getItem('symptomHistory') || '{}');
}

function loadReminders() {
    return JSON.parse(localStorage.getItem('reminders') || '[]');
}

// --- Symptoms Widget ---
function displayTodaysSymptoms() {
    const today = getTodayDate();
    const s = loadSymptoms();
    const contentDiv = document.getElementById('todaysSymptomsContent');

    if (s[today]) {
        const dt = s[today];
        let html = '';
        if (dt.feeling) html += `<div><strong>Overall Feeling:</strong> ${dt.feeling}</div>`;
        if (dt.fever) html += `<div><strong>Fever:</strong> ${dt.fever === 'Yes' ? dt.feverSeverity : 'None'}</div>`;
        if (dt.cough) html += `<div><strong>Cough:</strong> ${dt.cough === 'Yes' ? dt.coughSeverity : 'None'}</div>`;
        if (dt.fatigue) html += `<div><strong>Fatigue:</strong> ${dt.fatigue === 'Yes' ? dt.fatigueSeverity : 'None'}</div>`;
        if (dt.other) html += `<div><strong>Other:</strong> ${dt.other}</div>`;
        contentDiv.innerHTML = html;
    } else {
        contentDiv.innerHTML = '<div style="color:#888;font-style:italic;">No symptoms recorded today.</div>';
    }
}

// --- Reminders Widget with AM/PM ---
function displayTodaysReminders() {
    const today = getTodayDate();
    const reminders = loadReminders().filter(r => r.date === today);
    const contentDiv = document.getElementById('todaysRemindersContent');

    if (reminders.length > 0) {
        let html = '';
        reminders.forEach(r => {
            let timeStr = '';
            if (r.time) {
                const [hourStr, minStr] = r.time.split(':');
                let hour = parseInt(hourStr);
                const min = minStr;
                const ampm = hour >= 12 ? 'PM' : 'AM';
                if (hour === 0) hour = 12;
                else if (hour > 12) hour -= 12;
                timeStr = ` at ${hour}:${min} ${ampm}`;
            }
            html += `<div><strong>${r.title}</strong>${timeStr}`;
            if (r.note) html += `<div style="font-size:0.85em;color:#666;">${r.note}</div>`;
            html += `</div>`;
        });
        contentDiv.innerHTML = html;
    } else {
        contentDiv.innerHTML = '<div style="color:#888;font-style:italic;">No reminders for today.</div>';
    }
}

// --- Initialize Widgets ---
document.addEventListener('DOMContentLoaded', () => {
    displayTodaysSymptoms();
    displayTodaysReminders();
});
</script>
{% endblock %}
