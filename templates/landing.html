{% extends "base.html" %}

{% block title %}Home{% endblock %}

{% block content %}
<div style="
    width: 100%;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 40px 60px;
    box-sizing: border-box;
">

    <div style="display: flex; justify-content: space-between; align-items: flex-start; width: 100%; max-width: 1200px; gap: 40px;">

        <!-- Main Centered Section -->
        <div style="flex: 1; text-align: center; display: flex; flex-direction: column; justify-content: center; align-items: center; gap: 20px;">
            <h1 style="font-size: 3.2em; margin: 0.2em 0; color: #1976d2; font-weight: 700; text-shadow: 0 2px 4px rgba(25, 118, 210, 0.2);">GlycoGenie</h1>
            <h2 style="font-weight: 400; color: #424242; margin-bottom: 1em; font-size: 1.5em;">Your Health Management Dashboard</h2>
            <p style="max-width: 600px; color: #555; line-height: 1.8; margin: 0 auto 1.5em auto; font-size: 1.1em;">
                Welcome to your personalized health dashboard. Here, you can record symptoms, schedule reminders, and generate accurate food analysis reports ‚Äî all in one place.
            </p>
            
            <!-- Quick Action Cards -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; width: 100%; max-width: 700px; margin-top: 30px;">
                <a href="/symptomTracker" style="background: linear-gradient(135deg, #1976d2 0%, #1565c0 100%); color: white; padding: 1.5em; border-radius: 12px; text-decoration: none; font-size: 1.1em; font-weight: 600; box-shadow: 0 4px 12px rgba(25, 118, 210, 0.3); transition: all 0.3s ease; display: flex; flex-direction: column; align-items: center; gap: 10px;">
                    <span style="font-size: 2em;">üìã</span>
                    <span>Track Symptoms</span>
                </a>
                <a href="/reminders" style="background: linear-gradient(135deg, #1976d2 0%, #1565c0 100%); color: white; padding: 1.5em; border-radius: 12px; text-decoration: none; font-size: 1.1em; font-weight: 600; box-shadow: 0 4px 12px rgba(25, 118, 210, 0.3); transition: all 0.3s ease; display: flex; flex-direction: column; align-items: center; gap: 10px;">
                    <span style="font-size: 2em;">‚è∞</span>
                    <span>Reminders</span>
                </a>
                <a href="/upload" style="background: linear-gradient(135deg, #1976d2 0%, #1565c0 100%); color: white; padding: 1.5em; border-radius: 12px; text-decoration: none; font-size: 1.1em; font-weight: 600; box-shadow: 0 4px 12px rgba(25, 118, 210, 0.3); transition: all 0.3s ease; display: flex; flex-direction: column; align-items: center; gap: 10px;">
                    <span style="font-size: 2em;">üì§</span>
                    <span>Upload Food</span>
                </a>
            </div>
            
            <p style="margin-top: 3em; color: #888; font-size: 0.95em;">Developed by Henry, Opparam, and Rita</p>
            <p style="color:#999; font-size: 0.85em;">Test value: {{test_value}}</p>
        </div>

        <!-- Right Widgets -->
        <div style="display: flex; flex-direction: column; gap: 20px; width: 300px;">

            <!-- Today's Symptoms Widget -->
            <div id="todaysSymptomsWidget" style="display: block; background: white; border-radius: 16px; padding: 24px; box-shadow: 0 4px 16px rgba(25, 118, 210, 0.15); color: #222; border: 2px solid #e3f2fd;">
                <h3 style="color: #1976d2; margin-bottom: 12px; font-size: 1.2em; font-weight: 700;">üìã Today's Symptoms</h3>
                <div id="todaysSymptomsContent" style="font-size: 0.95em; color: #555; line-height: 1.6;">
                    Loading...
                </div>
            </div>

            <!-- Today's Reminders Widget -->
            <div id="todaysRemindersWidget" style="display: block; background: white; border-radius: 16px; padding: 24px; box-shadow: 0 4px 16px rgba(25, 118, 210, 0.15); color: #222; border: 2px solid #e3f2fd;">
                <h3 style="color: #1976d2; margin-bottom: 12px; font-size: 1.2em; font-weight: 700;">‚è∞ Today's Reminders</h3>
                <div id="todaysRemindersContent" style="font-size: 0.95em; color: #555; line-height: 1.6;">
                    Loading...
                </div>
            </div>

        </div>

    </div>
</div>

<style>
    html, body {
        height: 100%;
        margin: 0;
        font-family: 'Inter', 'Segoe UI', Arial, sans-serif;
    }
    
    a:hover {
        transform: translateY(-4px);
        box-shadow: 0 6px 20px rgba(25, 118, 210, 0.4) !important;
    }
    
    /* Mobile Responsive */
    @media (max-width: 968px) {
        div[style*="display: flex; justify-content: space-between"] {
            flex-direction: column !important;
            align-items: center !important;
        }
        
        div[style*="width: 300px"] {
            width: 100% !important;
            max-width: 600px;
        }
    }
</style>

<script>
// --- Utility Functions ---
function getTodayDate() {
    const t = new Date();
    return `${t.getFullYear()}-${String(t.getMonth() + 1).padStart(2,'0')}-${String(t.getDate()).padStart(2,'0')}`;
}

function loadSymptoms() {
    return JSON.parse(localStorage.getItem('symptomHistory') || '{}');
}

function loadReminders() {
    return JSON.parse(localStorage.getItem('reminders') || '[]');
}

// --- Symptoms Widget ---
function displayTodaysSymptoms() {
    const today = getTodayDate();
    const s = loadSymptoms();
    const contentDiv = document.getElementById('todaysSymptomsContent');

    if (s[today]) {
        const dt = s[today];
        let html = '';
        if (dt.feeling) html += `<div><strong>Overall Feeling:</strong> ${dt.feeling}</div>`;
        if (dt.fever) html += `<div><strong>Fever:</strong> ${dt.fever === 'Yes' ? dt.feverSeverity : 'None'}</div>`;
        if (dt.cough) html += `<div><strong>Cough:</strong> ${dt.cough === 'Yes' ? dt.coughSeverity : 'None'}</div>`;
        if (dt.fatigue) html += `<div><strong>Fatigue:</strong> ${dt.fatigue === 'Yes' ? dt.fatigueSeverity : 'None'}</div>`;
        if (dt.other) html += `<div><strong>Other:</strong> ${dt.other}</div>`;
        contentDiv.innerHTML = html;
    } else {
        contentDiv.innerHTML = '<div style="color:#888;font-style:italic;">No symptoms recorded today.</div>';
    }
}

// --- Reminders Widget with AM/PM ---
function displayTodaysReminders() {
    const today = getTodayDate();
    const reminders = loadReminders().filter(r => r.date === today);
    const contentDiv = document.getElementById('todaysRemindersContent');

    if (reminders.length > 0) {
        let html = '<div style="display: flex; flex-direction: column; gap: 10px;">';
        reminders.forEach(r => {
            let timeStr = '';
            if (r.time) {
                const [hourStr, minStr] = r.time.split(':');
                let hour = parseInt(hourStr);
                const min = minStr;
                const ampm = hour >= 12 ? 'PM' : 'AM';
                if (hour === 0) hour = 12;
                else if (hour > 12) hour -= 12;
                timeStr = ` at ${hour}:${min} ${ampm}`;
            }
            html += `<div style="background: #f5f9ff; padding: 10px; border-radius: 8px; border-left: 3px solid #1976d2;">`;
            html += `<strong style="color: #1976d2;">${r.title}</strong>${timeStr}`;
            if (r.note) html += `<div style="font-size:0.85em;color:#666;margin-top:4px;">${r.note}</div>`;
            html += `</div>`;
        });
        html += '</div>';
        contentDiv.innerHTML = html;
    } else {
        contentDiv.innerHTML = '<div style="color:#888;font-style:italic;">No reminders for today.</div>';
    }
}

// --- Initialize Widgets ---
document.addEventListener('DOMContentLoaded', () => {
    displayTodaysSymptoms();
    displayTodaysReminders();
});

// --- Listen for storage changes to update widgets in real-time ---
window.addEventListener('storage', () => {
    displayTodaysSymptoms();
    displayTodaysReminders();
});
</script>
{% endblock %}
