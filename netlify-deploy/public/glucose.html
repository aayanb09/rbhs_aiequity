<!DOCTYPE html>
<html>
<head>
 <title>GlycoGenie</title>
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 
 <!-- CRITICAL: Apply theme BEFORE anything else loads to prevent flash -->
 <script>
   (function() {
     try {
       var settings = JSON.parse(localStorage.getItem('appSettings') || '{}');
       var isDark = settings.theme === 'dark' || (settings.theme === 'auto' && window.matchMedia('(prefers-color-scheme: dark)').matches);
       if (isDark) {
         document.documentElement.classList.add('dark-theme');
       }
       if (settings.compactMode) {
         document.documentElement.classList.add('compact-mode');
       }
     } catch(e) {}
   })();
 </script>
 
 <link rel="preconnect" href="https://fonts.googleapis.com">
 <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
 <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
 <script src="https://unpkg.com/lucide@latest"></script>
 <style>
   :root {
     --bg-primary: #f8fafc;
     --bg-secondary: #ffffff;
     --text-primary: #0f172a;
     --text-secondary: #475569;
     --border-color: #e2e8f0;
   }
   
   * {
     margin: 0;
     padding: 0;
     box-sizing: border-box;
   }
   
   body { 
     font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif; 
     background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
     color: #0f172a; 
     margin: 0;
     min-height: 100vh;
     -webkit-font-smoothing: antialiased;
     -moz-osx-font-smoothing: grayscale;
     transition: background-color 0.3s ease, color 0.3s ease;
   }
   
   /* Menu Toggle Button */
   .menu-toggle {
     position: fixed;
     left: 24px;
     top: 24px;
     width: 52px;
     height: 52px;
     background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
     border: none;
     border-radius: 14px;
     cursor: pointer;
     display: flex;
     flex-direction: column;
     justify-content: center;
     align-items: center;
     gap: 5px;
     z-index: 1001;
     box-shadow: 0 8px 24px rgba(30, 64, 175, 0.25), 0 2px 8px rgba(0, 0, 0, 0.1);
     transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
   }
   
   .menu-toggle:hover {
     transform: translateY(-2px);
     box-shadow: 0 12px 32px rgba(30, 64, 175, 0.35), 0 4px 12px rgba(0, 0, 0, 0.15);
   }
   
   .menu-toggle:active {
     transform: translateY(0);
   }
   
   .menu-toggle span {
     width: 26px;
     height: 3px;
     background: white;
     border-radius: 3px;
     transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
   }
   
   .menu-toggle.active span:nth-child(1) {
     transform: rotate(45deg) translate(7px, 7px);
   }
   
   .menu-toggle.active span:nth-child(2) {
     opacity: 0;
     transform: translateX(-10px);
   }
   
   .menu-toggle.active span:nth-child(3) {
     transform: rotate(-45deg) translate(7px, -7px);
   }
   
   /* Sidebar Navigation */
   .sidebar {
     position: fixed;
     left: -280px;
     top: 0;
     width: 280px;
     height: 100vh;
     background: linear-gradient(180deg, #1e40af 0%, #1e3a8a 100%);
     padding: 28px 20px;
     display: flex;
     flex-direction: column;
     box-shadow: 8px 0 32px rgba(30, 64, 175, 0.15);
     z-index: 1000;
     transition: left 0.4s cubic-bezier(0.4, 0, 0.2, 1);
     overflow-y: auto;
   }
   
   .sidebar.open {
     left: 0;
   }
   
   /* Overlay for mobile */
   .sidebar-overlay {
     position: fixed;
     top: 0;
     left: 0;
     width: 100%;
     height: 100%;
     background: rgba(0, 0, 0, 0.6);
     z-index: 999;
     opacity: 0;
     visibility: hidden;
     transition: opacity 0.4s cubic-bezier(0.4, 0, 0.2, 1), visibility 0.4s cubic-bezier(0.4, 0, 0.2, 1);
     backdrop-filter: blur(4px);
   }
   
   .sidebar-overlay.active {
     opacity: 1;
     visibility: visible;
   }
   
   .logo-container {
     display: flex;
     flex-direction: column;
     align-items: center;
     justify-content: center;
     margin-bottom: 36px;
     padding-bottom: 28px;
     border-bottom: 1px solid rgba(255, 255, 255, 0.15);
   }
   
   .logo {
     max-width: 88px;
     height: auto;
     border-radius: 18px;
     box-shadow: 0 8px 24px rgba(0, 0, 0, 0.25);
     margin-bottom: 14px;
     transition: transform 0.3s ease;
   }
   
   .logo:hover {
     transform: scale(1.05);
   }
   
   .app-title {
     color: white;
     font-size: 1.625rem;
     font-weight: 800;
     text-align: center;
     letter-spacing: -0.03em;
   }
   
   .nav-links {
     display: flex;
     flex-direction: column;
     gap: 8px;
     flex: 1;
   }
   
   .nav-links a {
     color: rgba(255, 255, 255, 0.85);
     text-decoration: none;
     padding: 14px 18px;
     border-radius: 12px;
     font-weight: 500;
     font-size: 0.9875rem;
     transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
     display: flex;
     align-items: center;
     gap: 14px;
     background: transparent;
     position: relative;
     overflow: hidden;
   }
   
   .nav-links a::before {
     content: '';
     position: absolute;
     left: 0;
     top: 50%;
     transform: translateY(-50%);
     width: 4px;
     height: 0;
     background: white;
     border-radius: 0 3px 3px 0;
     transition: height 0.25s cubic-bezier(0.4, 0, 0.2, 1);
   }
   
   .nav-links a::after {
     content: '';
     position: absolute;
     top: 0;
     left: 0;
     right: 0;
     bottom: 0;
     background: linear-gradient(90deg, rgba(255, 255, 255, 0.1) 0%, transparent 100%);
     opacity: 0;
     transition: opacity 0.25s ease;
   }
   
   .nav-links a:hover {
     background: rgba(255, 255, 255, 0.12);
     color: white;
     transform: translateX(4px);
   }
   
   .nav-links a:hover::before {
     height: 28px;
   }
   
   .nav-links a:hover::after {
     opacity: 1;
   }
   
   .nav-links a.active {
     background: rgba(255, 255, 255, 0.18);
     color: white;
     font-weight: 600;
   }
   
   .nav-links a.active::before {
     height: 28px;
   }
   
   .nav-icon {
     display: flex;
     align-items: center;
     justify-content: center;
     width: 22px;
     height: 22px;
     position: relative;
     z-index: 1;
   }
   
   /* Main Content Area */
   .content { 
     margin-left: 0;
     padding: 0;
     min-height: 100vh;
     transition: margin-left 0.4s cubic-bezier(0.4, 0, 0.2, 1);
   }
   
   /* Compact Mode */
   body.compact-mode .sidebar {
     padding: 20px 16px;
   }
   
   body.compact-mode .logo-container {
     margin-bottom: 24px;
     padding-bottom: 20px;
   }
   
   body.compact-mode .logo {
     max-width: 72px;
   }
   
   body.compact-mode .app-title {
     font-size: 1.375rem;
   }
   
   body.compact-mode .nav-links {
     gap: 6px;
   }
   
   body.compact-mode .nav-links a {
     padding: 11px 14px;
     font-size: 0.9375rem;
   }
   
   /* Mobile Responsive */
   @media (max-width: 768px) {
     .menu-toggle {
       left: 20px;
       top: 20px;
       width: 48px;
       height: 48px;
     }
     
     .logo-container {
       flex-direction: row;
       padding-bottom: 0;
       border-bottom: none;
       margin-bottom: 20px;
       gap: 12px;
     }
     
     .logo {
       max-width: 52px;
       margin-bottom: 0;
     }
     
     .app-title {
       font-size: 1.375rem;
     }
   }
   
   /* ========== DARK THEME - HIGH PRIORITY OVERRIDES ========== */
   html.dark-theme,
   html.dark-theme body,
   body.dark-theme {
     background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%) !important;
     color: #f8fafc !important;
   }
   
   html.dark-theme .sidebar,
   body.dark-theme .sidebar {
     background: linear-gradient(180deg, #0f172a 0%, #1e293b 100%) !important;
   }
   
   html.dark-theme .menu-toggle,
   body.dark-theme .menu-toggle {
     background: linear-gradient(135deg, #1e40af 0%, #1e3a8a 100%) !important;
   }
   
   /* Dark theme for page containers */
   html.dark-theme .home-container,
   html.dark-theme .symptom-container,
   html.dark-theme .reminders-container,
   html.dark-theme .upload-container,
   html.dark-theme .glucose-container,
   html.dark-theme .settings-container,
   body.dark-theme .home-container,
   body.dark-theme .symptom-container,
   body.dark-theme .reminders-container,
   body.dark-theme .upload-container,
   body.dark-theme .glucose-container,
   body.dark-theme .settings-container {
     background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%) !important;
   }
   
   html.dark-theme .home-container::before,
   html.dark-theme .symptom-container::before,
   html.dark-theme .reminders-container::before,
   html.dark-theme .upload-container::before,
   html.dark-theme .glucose-container::before,
   html.dark-theme .settings-container::before,
   body.dark-theme .home-container::before,
   body.dark-theme .symptom-container::before,
   body.dark-theme .reminders-container::before,
   body.dark-theme .upload-container::before,
   body.dark-theme .glucose-container::before,
   body.dark-theme .settings-container::before {
     background: radial-gradient(circle at 30% 20%, rgba(59, 130, 246, 0.08) 0%, transparent 50%),
                 radial-gradient(circle at 70% 80%, rgba(147, 51, 234, 0.08) 0%, transparent 50%) !important;
   }
   
   /* Dark theme for cards and sections */
   html.dark-theme .page-header,
   html.dark-theme .symptom-form,
   html.dark-theme .widget,
   html.dark-theme .action-card,
   html.dark-theme .card,
   html.dark-theme .side-panel,
   html.dark-theme .info-banner,
   html.dark-theme .stat-card,
   html.dark-theme .calendar,
   html.dark-theme .settings-section,
   body.dark-theme .page-header,
   body.dark-theme .symptom-form,
   body.dark-theme .widget,
   body.dark-theme .action-card,
   body.dark-theme .card,
   body.dark-theme .side-panel,
   body.dark-theme .info-banner,
   body.dark-theme .stat-card,
   body.dark-theme .calendar,
   body.dark-theme .settings-section {
     background: #1e293b !important;
     border-color: #334155 !important;
     color: #f8fafc !important;
   }
   
   /* Dark theme for SYMPTOM HISTORY - IMPROVED READABILITY */
   html.dark-theme .history-item,
   body.dark-theme .history-item {
     background: linear-gradient(135deg, #1e293b 0%, #334155 100%) !important;
     border-left-color: #60a5fa !important;
   }
   
   html.dark-theme .history-date,
   body.dark-theme .history-date {
     color: #60a5fa !important;
   }
   
   html.dark-theme .history-detail,
   body.dark-theme .history-detail {
     color: #cbd5e1 !important;
   }
   
   html.dark-theme .history-detail strong,
   body.dark-theme .history-detail strong {
     color: #f8fafc !important;
   }
   
   html.dark-theme .modal-content,
   body.dark-theme .modal-content {
     background: #1e293b !important;
     border-color: #334155 !important;
   }
   
   html.dark-theme .modal-title,
   body.dark-theme .modal-title {
     color: #f8fafc !important;
   }
   
   html.dark-theme .close-btn,
   body.dark-theme .close-btn {
     background: #334155 !important;
     color: #cbd5e1 !important;
   }
   
   html.dark-theme .close-btn:hover,
   body.dark-theme .close-btn:hover {
     background: #475569 !important;
     color: #f8fafc !important;
   }
   
   html.dark-theme .empty-state,
   body.dark-theme .empty-state {
     color: #94a3b8 !important;
   }
   
   /* Dark theme for calendar */
   html.dark-theme .calendar th,
   body.dark-theme .calendar th {
     background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%) !important;
   }
   
   html.dark-theme .calendar td,
   body.dark-theme .calendar td {
     background: #1e293b !important;
     border-color: #334155 !important;
   }
   
   html.dark-theme .calendar td:hover,
   body.dark-theme .calendar td:hover {
     background: #334155 !important;
   }
   
   /* Dark theme for text elements */
   html.dark-theme .hero-title,
   html.dark-theme .hero-subtitle,
   html.dark-theme .page-header h1,
   html.dark-theme .section-title,
   html.dark-theme .card-title,
   html.dark-theme .setting-label,
   html.dark-theme .action-text,
   html.dark-theme .widget-title,
   html.dark-theme .item-label,
   html.dark-theme .form-label,
   html.dark-theme .stat-value,
   html.dark-theme .panel-title,
   body.dark-theme .hero-title,
   body.dark-theme .hero-subtitle,
   body.dark-theme .page-header h1,
   body.dark-theme .section-title,
   body.dark-theme .card-title,
   body.dark-theme .setting-label,
   body.dark-theme .action-text,
   body.dark-theme .widget-title,
   body.dark-theme .item-label,
   body.dark-theme .form-label,
   body.dark-theme .stat-value,
   body.dark-theme .panel-title {
     color: #f8fafc !important;
   }
   
   html.dark-theme .hero-description,
   html.dark-theme .setting-description,
   html.dark-theme .widget-content,
   html.dark-theme .item-value,
   html.dark-theme .info-banner,
   html.dark-theme .stat-label,
   html.dark-theme .placeholder,
   body.dark-theme .hero-description,
   body.dark-theme .setting-description,
   body.dark-theme .widget-content,
   body.dark-theme .item-value,
   body.dark-theme .info-banner,
   body.dark-theme .stat-label,
   body.dark-theme .placeholder {
     color: #cbd5e1 !important;
   }
   
   /* Dark theme for inputs */
   html.dark-theme input,
   html.dark-theme textarea,
   html.dark-theme select,
   html.dark-theme .form-textarea,
   html.dark-theme .form-input,
   html.dark-theme .form-select,
   html.dark-theme .settings-input,
   html.dark-theme .settings-select,
   body.dark-theme input,
   body.dark-theme textarea,
   body.dark-theme select,
   body.dark-theme .form-textarea,
   body.dark-theme .form-input,
   body.dark-theme .form-select,
   body.dark-theme .settings-input,
   body.dark-theme .settings-select {
     background: #0f172a !important;
     color: #f8fafc !important;
     border-color: #334155 !important;
   }
   
   html.dark-theme input:focus,
   html.dark-theme textarea:focus,
   html.dark-theme select:focus,
   body.dark-theme input:focus,
   body.dark-theme textarea:focus,
   body.dark-theme select:focus {
     border-color: #3b82f6 !important;
   }
   
   /* Dark theme for buttons */
   html.dark-theme .emoji-btn,
   html.dark-theme .yn-btn,
   body.dark-theme .emoji-btn,
   body.dark-theme .yn-btn {
     background: #334155 !important;
     border-color: #475569 !important;
     color: #cbd5e1 !important;
   }
   
   html.dark-theme .emoji-btn:hover,
   html.dark-theme .yn-btn:hover,
   body.dark-theme .emoji-btn:hover,
   body.dark-theme .yn-btn:hover {
     background: #475569 !important;
   }
   
   html.dark-theme .emoji-btn svg,
   html.dark-theme .yn-btn svg,
   html.dark-theme .emoji-btn-label,
   body.dark-theme .emoji-btn svg,
   body.dark-theme .yn-btn svg,
   body.dark-theme .emoji-btn-label {
     color: #cbd5e1 !important;
   }
   
   html.dark-theme .emoji-btn.selected,
   html.dark-theme .yn-btn.selected,
   body.dark-theme .emoji-btn.selected,
   body.dark-theme .yn-btn.selected {
     background: linear-gradient(135deg, #1e3a5f 0%, #1e40af 100%) !important;
     border-color: #3b82f6 !important;
     color: #dbeafe !important;
   }
   
   html.dark-theme .emoji-btn.selected svg,
   html.dark-theme .yn-btn.selected svg,
   html.dark-theme .emoji-btn.selected .emoji-btn-label,
   body.dark-theme .emoji-btn.selected svg,
   body.dark-theme .yn-btn.selected svg,
   body.dark-theme .emoji-btn.selected .emoji-btn-label {
     color: #dbeafe !important;
   }
   
   /* Dark theme for events and items */
   html.dark-theme .event,
   html.dark-theme .symptom-item,
   html.dark-theme .reminder-item,
   html.dark-theme .log-item,
   html.dark-theme .stat-box,
   html.dark-theme .prediction-result,
   body.dark-theme .event,
   body.dark-theme .symptom-item,
   body.dark-theme .reminder-item,
   body.dark-theme .log-item,
   body.dark-theme .stat-box,
   body.dark-theme .prediction-result {
     background: linear-gradient(135deg, #1e293b 0%, #334155 100%) !important;
     color: #dbeafe !important;
   }
   
   html.dark-theme .log-time,
   html.dark-theme .prediction-title,
   html.dark-theme .prediction-value,
   body.dark-theme .log-time,
   body.dark-theme .prediction-title,
   body.dark-theme .prediction-value {
     color: #60a5fa !important;
   }
   
   html.dark-theme .log-details,
   html.dark-theme .prediction-details,
   body.dark-theme .log-details,
   body.dark-theme .prediction-details {
     color: #cbd5e1 !important;
   }
   
   html.dark-theme .widget-empty,
   body.dark-theme .widget-empty {
     background: #0f172a !important;
     color: #94a3b8 !important;
   }
   
   /* Dark theme for checkbox labels */
   html.dark-theme .checkbox-label,
   body.dark-theme .checkbox-label {
     color: #cbd5e1 !important;
   }
   
   html.dark-theme .checkbox-label:hover,
   body.dark-theme .checkbox-label:hover {
     background: #334155 !important;
   }
   
   /* Dark theme for results */
   html.dark-theme .results-list li,
   body.dark-theme .results-list li {
     background: linear-gradient(135deg, #1e293b 0%, #334155 100%) !important;
     color: #cbd5e1 !important;
   }
   
   /* Dark theme for month tabs */
   html.dark-theme .month-tabs,
   body.dark-theme .month-tabs {
     background: #1e293b !important;
     border-color: #334155 !important;
   }
   
   html.dark-theme .month-tabs button,
   body.dark-theme .month-tabs button {
     background: #334155 !important;
     color: #cbd5e1 !important;
   }
   
   html.dark-theme .month-tabs button.active,
   html.dark-theme .month-tabs button:hover,
   body.dark-theme .month-tabs button.active,
   body.dark-theme .month-tabs button:hover {
     background: linear-gradient(135deg, #1e3a5f 0%, #1e40af 100%) !important;
     color: #dbeafe !important;
   }
   
   /* Dark theme for display area */
   html.dark-theme .display-area,
   body.dark-theme .display-area {
     background: linear-gradient(135deg, #0f172a 0%, #000000 100%) !important;
     border-color: #334155 !important;
   }
   
   /* Dark theme for date elements */
   html.dark-theme .date,
   body.dark-theme .date {
     color: #94a3b8 !important;
   }
   
   /* Dark theme for action buttons */
   html.dark-theme .action-btn,
   body.dark-theme .action-btn {
     background: #1e293b !important;
     border-color: #334155 !important;
     color: #f8fafc !important;
   }
   
   html.dark-theme .action-btn:hover,
   body.dark-theme .action-btn:hover {
     border-color: #3b82f6 !important;
   }
 </style>
  <script src="/config.js"></script>
</head>
<body>
 <!-- Menu Toggle Button -->
 <button class="menu-toggle" id="menuToggle" aria-label="Toggle Menu">
   <span></span>
   <span></span>
   <span></span>
 </button>

 <!-- Overlay -->
 <div class="sidebar-overlay" id="sidebarOverlay"></div>

 <div class="sidebar" id="sidebar">
   <div class="logo-container">
     <a href="/home">
       <img src="" alt="Logo" class="logo">
     </a>
     <div class="app-title">GlycoGenie</div>
   </div>
   
   <div class="nav-links">
     <a href="/home" class="active">
       <span class="nav-icon"><i data-lucide="home"></i></span>
       <span>Home</span>
     </a>
     <a href="/glucose" class="active">
       <span class="nav-icon"><i data-lucide="activity"></i></span>
       <span>Glucose Tracker</span>
     </a>
     <a href="/symptomTracker" class="active">
       <span class="nav-icon"><i data-lucide="clipboard-list"></i></span>
       <span>Track Symptoms</span>
     </a>
     <a href="/reminders" class="active">
       <span class="nav-icon"><i data-lucide="bell"></i></span>
       <span>Reminders</span>
     </a>
     <a href="/upload" class="active">
       <span class="nav-icon"><i data-lucide="upload"></i></span>
       <span>Upload Food</span>
     </a>
     <a href="/settings" class="active">
       <span class="nav-icon"><i data-lucide="settings"></i></span>
       <span>Settings</span>
     </a>
   </div>
 </div>
 
 <div class="content">
   

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>

<style>
.glucose-container {
  background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
  min-height: 100vh;
  padding: 48px;
  position: relative;
}

.glucose-container::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: radial-gradient(circle at 30% 20%, rgba(59, 130, 246, 0.03) 0%, transparent 50%),
              radial-gradient(circle at 70% 80%, rgba(147, 51, 234, 0.03) 0%, transparent 50%);
  pointer-events: none;
}

.page-header {
  background: white;
  border: 2px solid #e2e8f0;
  color: #0f172a;
  padding: 36px 40px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  border-radius: 20px;
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.04);
  margin-bottom: 40px;
  max-width: 1400px;
  margin-left: auto;
  margin-right: auto;
  position: relative;
  z-index: 1;
  animation: fadeInDown 0.5s ease;
}

@keyframes fadeInDown {
  from {
    opacity: 0;
    transform: translateY(-20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.page-header::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: linear-gradient(90deg, #3b82f6, #8b5cf6);
  border-radius: 20px 20px 0 0;
}

.page-header-content {
  display: flex;
  align-items: center;
  gap: 14px;
}

.page-header-icon {
  width: 36px;
  height: 36px;
  color: #1e40af;
  stroke-width: 2.5;
}

.page-header h1 {
  margin: 0;
  font-size: 2.25rem;
  font-weight: 800;
  letter-spacing: -0.03em;
}

.content-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 28px;
  max-width: 1400px;
  margin: 0 auto;
  position: relative;
  z-index: 1;
  animation: fadeInUp 0.5s ease 0.1s backwards;
}

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.card {
  background: white;
  border: 2px solid #e2e8f0;
  border-radius: 20px;
  padding: 32px;
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.04);
  position: relative;
  overflow: hidden;
  transition: all 0.3s ease;
}

.card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 3px;
  background: linear-gradient(90deg, #3b82f6, #8b5cf6);
}

.card:hover {
  box-shadow: 0 12px 32px rgba(0, 0, 0, 0.08);
  transform: translateY(-2px);
}

.card-title {
  font-size: 1.5rem;
  font-weight: 800;
  color: #0f172a;
  margin-bottom: 24px;
  display: flex;
  align-items: center;
  gap: 10px;
  letter-spacing: -0.02em;
}

.card-title svg {
  width: 26px;
  height: 26px;
  color: #1e40af;
  stroke-width: 2.5;
}

.form-section {
  margin-bottom: 24px;
}

.form-label {
  display: block;
  font-weight: 700;
  color: #475569;
  margin-bottom: 10px;
  font-size: 0.9375rem;
  letter-spacing: -0.01em;
}

.form-input,
.form-select {
  width: 100%;
  padding: 14px 16px;
  border: 2px solid #e2e8f0;
  border-radius: 12px;
  font-family: inherit;
  font-size: 1rem;
  transition: all 0.2s ease;
  color: #0f172a;
  font-weight: 500;
  background: white;
}

.form-input:focus,
.form-select:focus {
  outline: none;
  border-color: #3b82f6;
  box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
}

.form-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px;
}

.btn {
  background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
  color: white;
  border: none;
  padding: 14px 28px;
  border-radius: 12px;
  cursor: pointer;
  font-weight: 700;
  font-size: 0.9375rem;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  width: 100%;
  box-shadow: 0 4px 12px rgba(30, 64, 175, 0.25);
  letter-spacing: -0.01em;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

.btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(30, 64, 175, 0.35);
}

.btn:active {
  transform: translateY(0);
}

.btn svg {
  width: 18px;
  height: 18px;
}

.btn-secondary {
  background: #f1f5f9;
  color: #475569;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
}

.btn-secondary:hover {
  background: #e2e8f0;
  color: #1e293b;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
}

.btn-danger {
  background: #fef2f2 !important;
  color: #dc2626 !important;
  box-shadow: 0 2px 8px rgba(220, 38, 38, 0.15) !important;
}

.btn-danger:hover {
  background: #fee2e2 !important;
  color: #b91c1c !important;
  box-shadow: 0 4px 12px rgba(220, 38, 38, 0.25) !important;
}

.warning-banner {
  background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
  border-left: 4px solid #f59e0b;
  padding: 20px;
  border-radius: 12px;
  margin-bottom: 24px;
  display: flex;
  align-items: start;
  gap: 12px;
}

.warning-icon {
  width: 24px;
  height: 24px;
  color: #d97706;
  flex-shrink: 0;
  margin-top: 2px;
}

.warning-text {
  color: #92400e;
  font-size: 0.9375rem;
  line-height: 1.6;
  font-weight: 600;
}

.warning-text strong {
  font-weight: 800;
  display: block;
  margin-bottom: 4px;
}

.prediction-result {
  background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
  border-left: 4px solid #3b82f6;
  padding: 24px;
  border-radius: 12px;
  margin-top: 24px;
  display: none;
  animation: slideIn 0.3s ease;
}

@keyframes slideIn {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.prediction-title {
  font-weight: 700;
  color: #1e40af;
  font-size: 1.125rem;
  margin-bottom: 12px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.prediction-title svg {
  width: 20px;
  height: 20px;
}

.prediction-value {
  font-size: 2.5rem;
  font-weight: 800;
  color: #1e40af;
  margin-bottom: 8px;
  letter-spacing: -0.03em;
}

.prediction-details {
  color: #475569;
  font-size: 0.9375rem;
  line-height: 1.6;
  font-weight: 500;
}

.chart-container {
  position: relative;
  height: 320px;
  margin-top: 24px;
}

.log-list {
  display: flex;
  flex-direction: column;
  gap: 12px;
  max-height: 400px;
  overflow-y: auto;
  margin-top: 16px;
}

.log-item {
  background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
  padding: 16px;
  border-radius: 12px;
  border-left: 4px solid #3b82f6;
  transition: all 0.2s ease;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.log-item:hover {
  transform: translateX(4px);
  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.1);
}

.log-info {
  flex: 1;
}

.log-time {
  font-weight: 700;
  color: #1e40af;
  font-size: 0.9375rem;
  margin-bottom: 4px;
}

.log-details {
  color: #64748b;
  font-size: 0.875rem;
  font-weight: 500;
}

.log-actions {
  display: flex;
  gap: 8px;
}

.icon-btn {
  background: transparent;
  border: none;
  cursor: pointer;
  padding: 8px;
  border-radius: 8px;
  transition: all 0.2s ease;
  display: flex;
  align-items: center;
  justify-content: center;
}

.icon-btn:hover {
  background: #e2e8f0;
}

.icon-btn svg {
  width: 18px;
  height: 18px;
  color: #64748b;
}

.icon-btn.delete:hover svg {
  color: #dc2626;
}

.empty-state {
  text-align: center;
  color: #94a3b8;
  font-style: italic;
  padding: 48px 24px;
  font-size: 1.0625rem;
}

.stats-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 16px;
  margin-bottom: 24px;
}

.stat-box {
  background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
  padding: 20px;
  border-radius: 12px;
  border-left: 4px solid #3b82f6;
  text-align: center;
}

.stat-label {
  font-size: 0.875rem;
  color: #64748b;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  margin-bottom: 8px;
}

.stat-value {
  font-size: 1.875rem;
  font-weight: 800;
  color: #0f172a;
  letter-spacing: -0.02em;
}

.full-width {
  grid-column: 1 / -1;
}

.checkbox-group {
  display: flex;
  flex-direction: column;
  gap: 10px;
  margin-top: 10px;
}

.checkbox-label {
  display: flex;
  align-items: center;
  padding: 10px 12px;
  border-radius: 10px;
  transition: all 0.2s ease;
  cursor: pointer;
  font-size: 0.9375rem;
  color: #475569;
  font-weight: 600;
  border: 2px solid transparent;
}

.checkbox-label:hover {
  background: #f8fafc;
  border-color: #e2e8f0;
}

.checkbox-label input[type="checkbox"] {
  width: 18px;
  height: 18px;
  margin-right: 10px;
  cursor: pointer;
  accent-color: #3b82f6;
}

.checkbox-label input[type="checkbox"]:checked ~ span {
  color: #1e40af;
}

@media (max-width: 1024px) {
  .content-grid {
    grid-template-columns: 1fr;
  }
  
  .form-row {
    grid-template-columns: 1fr;
  }
}

@media (max-width: 768px) {
  .glucose-container {
    padding: 32px 24px;
  }

  .page-header {
    padding: 28px 24px;
    flex-direction: column;
    text-align: center;
  }

  .page-header h1 {
    font-size: 1.75rem;
  }

  .card {
    padding: 24px;
  }

  .stats-grid {
    grid-template-columns: 1fr;
  }
}
</style>

<div class="glucose-container">
  <!-- Medical Disclaimer -->
  <div class="warning-banner">
    <i data-lucide="alert-triangle" class="warning-icon"></i>
    <div class="warning-text">
      <strong>Medical Disclaimer</strong>
      This tool is for educational and tracking purposes only. It is NOT a medical device and should NEVER be used to make treatment decisions. Always verify with a blood glucose meter and consult your healthcare provider before making any changes to your diabetes management.
    </div>
  </div>

  <div class="page-header">
    <div class="page-header-content">
      <i data-lucide="activity" class="page-header-icon"></i>
      <h1>Glucose Tracker</h1>
    </div>
  </div>

  <div class="content-grid">
    <!-- Log Entry Card -->
    <div class="card">
      <h2 class="card-title">
        <i data-lucide="plus-circle"></i>
        <span>Log Entry</span>
      </h2>

      <form id="glucoseForm">
        <div class="form-section">
          <label class="form-label">Current Blood Glucose (mg/dL)</label>
          <input type="number" id="currentGlucose" class="form-input" placeholder="e.g., 120" min="0" required>
        </div>

        <div class="form-row">
          <div class="form-section">
            <label class="form-label">Insulin Dose (units)</label>
            <input type="number" id="insulinDose" class="form-input" placeholder="e.g., 10" min="0" step="0.5" required>
          </div>

          <div class="form-section">
            <label class="form-label">Insulin Type</label>
            <select id="insulinType" class="form-select" required>
              <option value="">Select type</option>
              <option value="rapid">Rapid-Acting</option>
              <option value="short">Short-Acting</option>
              <option value="intermediate">Intermediate-Acting</option>
              <option value="long">Long-Acting</option>
            </select>
          </div>
        </div>

        <div class="form-row">
          <div class="form-section">
            <label class="form-label">Date</label>
            <input type="date" id="logDate" class="form-input" required>
          </div>

          <div class="form-section">
            <label class="form-label">Time</label>
            <input type="time" id="logTime" class="form-input" required>
          </div>
        </div>

        <!-- NEW: Meal/Carb Tracking -->
        <div class="form-section">
          <label class="form-label">Carbohydrates Consumed (grams)</label>
          <input type="number" id="carbsConsumed" class="form-input" placeholder="e.g., 45" min="0" step="1">
          <small style="color: #64748b; font-size: 0.875rem; display: block; margin-top: 6px;">Optional: Helps improve prediction accuracy</small>
        </div>

        <!-- NEW: Recent Activity -->
        <div class="form-section">
          <label class="form-label">Recent Physical Activity</label>
          <select id="recentActivity" class="form-select">
            <option value="none">None</option>
            <option value="light">Light (walking, housework)</option>
            <option value="moderate">Moderate (jogging, cycling)</option>
            <option value="intense">Intense (running, sports)</option>
          </select>
        </div>

        <!-- NEW: Factors Affecting Reading -->
        <div class="form-section">
          <label class="form-label">Current Factors (select all that apply)</label>
          <div class="checkbox-group">
            <label class="checkbox-label">
              <input type="checkbox" id="factorStress" value="stress">
              <span>Feeling stressed</span>
            </label>
            <label class="checkbox-label">
              <input type="checkbox" id="factorIllness" value="illness">
              <span>Sick or feeling unwell</span>
            </label>
            <label class="checkbox-label">
              <input type="checkbox" id="factorMenstruation" value="menstruation">
              <span>Menstruation (for women)</span>
            </label>
            <label class="checkbox-label">
              <input type="checkbox" id="factorAlcohol" value="alcohol">
              <span>Had alcohol recently</span>
            </label>
          </div>
        </div>

        <div class="form-section">
          <label class="form-label">Notes (optional)</label>
          <input type="text" id="notes" class="form-input" placeholder="e.g., After breakfast">
        </div>

        <button type="submit" class="btn">
          <i data-lucide="save"></i>
          <span>Save Entry</span>
        </button>
      </form>
    </div>

    <!-- Prediction Card -->
    <div class="card">
      <h2 class="card-title">
        <i data-lucide="trending-up"></i>
        <span>Glucose Prediction</span>
      </h2>

      <div class="form-section">
        <label class="form-label">Predict glucose level after (hours)</label>
        <input type="number" id="predictionHours" class="form-input" placeholder="e.g., 2" min="0.5" max="8" step="0.5" value="2">
        <small style="color: #64748b; font-size: 0.875rem; display: block; margin-top: 6px;">Limited to 8 hours for accuracy</small>
      </div>

      <button type="button" class="btn" onclick="predictGlucose()">
        <i data-lucide="zap"></i>
        <span>Calculate Prediction</span>
      </button>

      <div id="predictionResult" class="prediction-result">
        <div class="prediction-title">
          <i data-lucide="target"></i>
          <span>Predicted Blood Glucose</span>
        </div>
        <div class="prediction-value" id="predictedValue">--</div>
        <div class="prediction-details" id="predictionDetails">--</div>
      </div>

      <div class="stats-grid" style="margin-top: 32px;">
        <div class="stat-box">
          <div class="stat-label">Avg Glucose</div>
          <div class="stat-value" id="avgGlucose">--</div>
        </div>
        <div class="stat-box">
          <div class="stat-label">Entries</div>
          <div class="stat-value" id="totalEntries">0</div>
        </div>
        <div class="stat-box">
          <div class="stat-label">Last Entry</div>
          <div class="stat-value" id="lastEntry" style="font-size: 1rem;">--</div>
        </div>
      </div>

      <div style="margin-top: 24px; display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
        <button type="button" class="btn btn-secondary" onclick="exportData()">
          <i data-lucide="download"></i>
          <span>Export Data</span>
        </button>
        <button type="button" class="btn btn-danger" onclick="clearAllData()">
          <i data-lucide="trash-2"></i>
          <span>Clear All</span>
        </button>
      </div>
    </div>

    <!-- History Card -->
    <div class="card full-width">
      <h2 class="card-title">
        <i data-lucide="clock"></i>
        <span>Recent Entries</span>
      </h2>

      <div id="logList" class="log-list">
        <div class="empty-state">No entries logged yet. Add your first entry to get started!</div>
      </div>
    </div>

    <!-- Chart Card -->
    <div class="card full-width">
      <h2 class="card-title">
        <i data-lucide="bar-chart-2"></i>
        <span>Glucose Trend (Last 7 Days)</span>
      </h2>
      <div class="chart-container">
        <canvas id="glucoseChart"></canvas>
      </div>
    </div>
  </div>
</div>

<script>
// Initialize Lucide icons
lucide.createIcons();

// Set default date and time to now
const now = new Date();
document.getElementById('logDate').valueAsDate = now;
document.getElementById('logTime').value = now.toTimeString().slice(0, 5);

// Generate unique ID
function generateId() {
  return 'glucose_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
}

// Load entries from localStorage
function loadEntries() {
  return JSON.parse(localStorage.getItem('glucoseEntries') || '[]');
}

// Save entries to localStorage
function saveEntries(entries) {
  localStorage.setItem('glucoseEntries', JSON.stringify(entries));
}

// Format date/time for display
function formatDateTime(date, time) {
  const d = new Date(date + 'T' + time);
  return d.toLocaleString('en-US', {
    month: 'short',
    day: 'numeric',
    year: 'numeric',
    hour: 'numeric',
    minute: '2-digit',
    hour12: true
  });
}

// Get insulin action parameters
function getInsulinParams(type) {
  const params = {
    rapid: { 
      onset: 0.17,
      peak: 1.0,
      duration: 5,
      peakEffect: 1.0,
      shape: 'biexponential'
    },
    short: { 
      onset: 0.5,
      peak: 2.5,
      duration: 8,
      peakEffect: 0.85,
      shape: 'gaussian'
    },
    intermediate: { 
      onset: 1.5,
      peak: 6,
      duration: 18,
      peakEffect: 0.6,
      shape: 'plateau'
    },
    long: { 
      onset: 2,
      peak: -1,
      duration: 24,
      peakEffect: 0.25,
      shape: 'flat'
    }
  };
  return params[type] || params.rapid;
}

// Calculate insulin activity
function calculateInsulinActivity(hours, params) {
  if (hours < params.onset) return 0;
  if (hours > params.duration) return 0;
  
  const effectiveTime = hours - params.onset;
  const effectiveDuration = params.duration - params.onset;
  
  let activity = 0;
  
  if (params.shape === 'flat') {
    if (effectiveTime < 2) {
      activity = (effectiveTime / 2) * params.peakEffect;
    } else if (effectiveTime > effectiveDuration - 2) {
      activity = ((effectiveDuration - effectiveTime) / 2) * params.peakEffect;
    } else {
      activity = params.peakEffect;
    }
  } else if (params.shape === 'plateau') {
    const peakStart = params.peak - 2;
    const peakEnd = params.peak + 3;
    
    if (effectiveTime < peakStart) {
      activity = (effectiveTime / peakStart) * params.peakEffect;
    } else if (effectiveTime <= peakEnd) {
      activity = params.peakEffect;
    } else {
      const fallProgress = (effectiveTime - peakEnd) / (effectiveDuration - peakEnd);
      activity = params.peakEffect * (1 - fallProgress);
    }
  } else if (params.shape === 'gaussian') {
    const sigma = effectiveDuration / 6;
    const mu = params.peak - params.onset;
    const gaussian = Math.exp(-Math.pow(effectiveTime - mu, 2) / (2 * Math.pow(sigma, 2)));
    activity = params.peakEffect * gaussian;
  } else {
    const peakTime = params.peak - params.onset;
    
    if (effectiveTime <= peakTime) {
      const progress = effectiveTime / peakTime;
      activity = params.peakEffect * (1 - Math.pow(1 - progress, 2));
    } else {
      const decayTime = effectiveTime - peakTime;
      const decayDuration = effectiveDuration - peakTime;
      const decayRate = 3 / decayDuration;
      activity = params.peakEffect * Math.exp(-decayRate * decayTime);
    }
  }
  
  return activity;
}

// Get user profile
function getUserProfile() {
  return JSON.parse(localStorage.getItem('userProfile') || '{}');
}

// Calculate personalized ISF
function calculatePersonalizedISF(profile, currentGlucose) {
  let baseISF = 40;
  
  if (profile.weight) {
    const estimatedTDD = parseFloat(profile.weight) * 0.5;
    baseISF = 1800 / estimatedTDD;
  }
  
  if (profile.age) {
    const age = parseInt(profile.age);
    if (age < 18) {
      baseISF *= 1.2;
    } else if (age > 65) {
      baseISF *= 1.15;
    }
  }
  
  if (profile.exerciseLevel) {
    const exerciseMultipliers = {
      'Sedentary': 0.9,
      'Lightly active': 1.0,
      'Moderately active': 1.1,
      'Very active': 1.2,
      'Extremely active': 1.3
    };
    baseISF *= (exerciseMultipliers[profile.exerciseLevel] || 1.0);
  }
  
  if (profile.bmi) {
    const bmi = parseFloat(profile.bmi);
    if (bmi > 30) {
      baseISF *= 0.8;
    } else if (bmi < 18.5) {
      baseISF *= 1.1;
    }
  }
  
  if (currentGlucose > 250) {
    baseISF *= 0.9;
  }
  
  return Math.max(20, Math.min(80, baseISF));
}

// NEW: Calculate carbohydrate impact
function calculateCarbImpact(carbsConsumed, hours, profile) {
  if (!carbsConsumed || carbsConsumed <= 0) return 0;
  
  // Carb absorption curve (peaks at ~30-45 minutes, complete by 2-3 hours)
  const peakTime = 0.75; // 45 minutes
  const duration = 2.5; // 2.5 hours for most carbs
  
  if (hours < 0) return 0;
  if (hours > duration) return 0;
  
  // Gaussian curve for carb absorption
  const sigma = duration / 4;
  const absorption = Math.exp(-Math.pow(hours - peakTime, 2) / (2 * Math.pow(sigma, 2)));
  
  // Calculate carb-to-glucose ratio (typically 1g carb = 3-5 mg/dL rise)
  let carbRatio = 4; // Default 4 mg/dL per gram
  
  // Adjust based on insulin sensitivity
  if (profile.bmi) {
    const bmi = parseFloat(profile.bmi);
    if (bmi > 30) {
      carbRatio = 5; // Higher BMI = larger glucose rise per carb
    } else if (bmi < 20) {
      carbRatio = 3;
    }
  }
  
  // Total glucose rise from carbs
  const maxRise = carbsConsumed * carbRatio;
  return maxRise * absorption;
}

// NEW: Calculate activity impact
function calculateActivityImpact(activityLevel, hours) {
  if (!activityLevel || activityLevel === 'none') return 0;
  
  const impacts = {
    'light': 15,      // Light activity reduces glucose by ~15 mg/dL
    'moderate': 30,   // Moderate activity reduces by ~30 mg/dL
    'intense': 50     // Intense activity reduces by ~50 mg/dL
  };
  
  const maxReduction = impacts[activityLevel] || 0;
  
  // Activity effect diminishes over time (half-life ~2 hours)
  const decay = Math.exp(-0.35 * hours);
  return maxReduction * decay;
}

// NEW: Calculate stress/illness impact
function calculateFactorImpacts(factors) {
  let totalImpact = 0;
  
  if (!factors || factors.length === 0) return 0;
  
  // Each factor can raise glucose
  if (factors.includes('stress')) totalImpact += 30; // Stress hormones raise glucose
  if (factors.includes('illness')) totalImpact += 40; // Illness significantly raises glucose
  if (factors.includes('menstruation')) totalImpact += 20; // Hormonal changes
  if (factors.includes('alcohol')) totalImpact -= 15; // Alcohol can lower glucose (delayed)
  
  return totalImpact;
}

// Calculate basal glucose change
function calculateBasalGlucoseChange(hours, profile, currentGlucose) {
  let netChange = 0;
  
  let glucoseProduction = 2.0;
  let glucoseUtilization = 1.5;
  
  if (profile.exerciseLevel) {
    const activityMultipliers = {
      'Sedentary': 0.8,
      'Lightly active': 1.0,
      'Moderately active': 1.2,
      'Very active': 1.4,
      'Extremely active': 1.6
    };
    glucoseUtilization *= (activityMultipliers[profile.exerciseLevel] || 1.0);
  }
  
  if (profile.age) {
    const age = parseInt(profile.age);
    if (age > 60) {
      glucoseUtilization *= 0.9;
    }
  }
  
  if (profile.conditions) {
    if (profile.conditions.includes('Obesity')) {
      glucoseProduction *= 1.2;
      glucoseUtilization *= 0.8;
    }
    if (profile.conditions.includes('Kidney Disease')) {
      glucoseUtilization *= 0.85;
    }
  }
  
  netChange = (glucoseProduction - glucoseUtilization) * hours;
  
  const projectedGlucose = currentGlucose + netChange;
  if (projectedGlucose < 70) {
    const hypoglycemiaResponse = (70 - projectedGlucose) * 0.4;
    netChange += hypoglycemiaResponse;
  }
  
  const now = new Date();
  const currentHour = now.getHours();
  const targetHour = (currentHour + hours) % 24;
  if (targetHour >= 4 && targetHour <= 8) {
    netChange += 10;
  }
  
  return netChange;
}

// Generate personalized advice
function generatePersonalizedAdvice(predictedGlucose, profile, entry) {
  let advice = '';
  
  if (predictedGlucose < 70) {
    advice = 'âš ï¸ <strong>Risk of hypoglycemia detected.</strong> ';
    advice += 'Consume 15g of fast-acting carbohydrates (4 glucose tablets, 4oz juice, or 1 tablespoon honey). ';
    advice += 'Recheck in 15 minutes with your glucose meter.';
    
    if (profile.conditions && profile.conditions.includes('Heart Disease')) {
      advice += '<br><br><strong>Important:</strong> Monitor closely due to heart condition - severe hypoglycemia can strain the heart.';
    }
    
    if (entry && entry.recentActivity && entry.recentActivity !== 'none') {
      advice += '<br><br><strong>Note:</strong> Recent physical activity increases hypoglycemia risk. Consider having a snack before further activity.';
    }
  } else if (predictedGlucose < 100) {
    advice = 'âœ“ Your glucose is predicted to be in a healthy range. Continue monitoring regularly.';
    
    if (profile.exerciseLevel === 'Very active' || profile.exerciseLevel === 'Extremely active') {
      advice += '<br><br>As an active individual, consider a small snack if planning exercise.';
    }
  } else if (predictedGlucose < 140) {
    advice = 'Slightly elevated glucose predicted.';
    
    if (profile.exerciseLevel !== 'Sedentary') {
      advice += ' A 15-20 minute walk could help lower levels.';
    } else {
      advice += ' Consider light physical activity if possible.';
    }
    
    if (profile.diet && (profile.diet.includes('Low-carb') || profile.diet.includes('Ketogenic'))) {
      advice += '<br><br>Your low-carb diet should help manage this elevation.';
    }
  } else if (predictedGlucose < 180) {
    advice = 'âš ï¸ <strong>Elevated glucose - needs attention.</strong> Monitor closely with your glucose meter.';
    
    if (profile.medications && profile.medications.toLowerCase().includes('metformin')) {
      advice += '<br><br>Ensure you\'ve taken your Metformin as prescribed.';
    }
    
    advice += '<br><br>Stay hydrated and avoid additional carbohydrates. Contact your healthcare provider if levels remain elevated.';
    
    if (entry && entry.factors && entry.factors.includes('illness')) {
      advice += '<br><br><strong>Note:</strong> Illness is affecting your glucose. Monitor more frequently and contact your doctor if needed.';
    }
  } else {
    advice = 'ðŸš¨ <strong>High glucose level predicted.</strong> Check with your glucose meter immediately.';
    
    if (profile.conditions && profile.conditions.includes('Diabetes')) {
      advice += '<br><br>Check for ketones, especially if you have Type 1 diabetes.';
    }
    
    advice += '<br><br>Stay hydrated, monitor frequently, and contact your healthcare provider for guidance.';
  }
  
  return advice;
}

// Calculate confidence score
function calculateConfidence(hoursElapsed, hours, profile, entries, entry) {
  let confidence = 100;
  
  // Reduce confidence for stale readings
  if (hoursElapsed > 2) confidence -= 10;
  if (hoursElapsed > 4) confidence -= 15;
  if (hoursElapsed > 6) confidence -= 20;
  
  // Reduce confidence for long predictions
  if (hours > 4) confidence -= 10;
  if (hours > 6) confidence -= 15;
  
  // Increase confidence if we have profile data
  if (profile.weight) confidence += 5;
  if (profile.exerciseLevel) confidence += 5;
  if (profile.conditions && profile.conditions.length > 0) confidence += 5;
  
  // Increase confidence if we have carb data
  if (entry && entry.carbsConsumed) confidence += 10;
  
  // Reduce confidence if factors are present
  if (entry && entry.factors && entry.factors.length > 0) confidence -= 10;
  
  // Increase confidence if we have historical data
  if (entries.length > 10) confidence += 10;
  if (entries.length > 30) confidence += 10;
  
  return Math.max(20, Math.min(95, confidence));
}

// Predict glucose level
function predictGlucose() {
  const entries = loadEntries();
  if (entries.length === 0) {
    showAlert('Please add at least one glucose entry before making predictions.', 'warning', 'No Entries Found');
    return;
  }

  const hoursInput = document.getElementById('predictionHours').value;
  const hours = parseFloat(hoursInput);
  
  if (!hoursInput || isNaN(hours) || hours <= 0) {
    showAlert('Please enter a valid number of hours greater than 0.', 'error', 'Invalid Input');
    return;
  }

  if (hours > 8) {
    showAlert('Please enter a time period up to 8 hours for more accurate predictions. Longer predictions have too many unknown variables.', 'warning', 'Time Period Too Long');
    return;
  }

  const profile = getUserProfile();

  const sortedEntries = entries.sort((a, b) => {
    const dateA = new Date(a.date + 'T' + a.time);
    const dateB = new Date(b.date + 'T' + b.time);
    return dateB - dateA;
  });
  
  const latest = sortedEntries[0];
  const entryTime = new Date(latest.date + 'T' + latest.time);
  const now = new Date();
  const hoursElapsed = (now - entryTime) / (1000 * 60 * 60);
  const totalHours = hoursElapsed + hours;

  const params = getInsulinParams(latest.insulinType);
  const currentGlucose = parseFloat(latest.currentGlucose);
  const insulinDose = parseFloat(latest.insulinDose);

  const isf = calculatePersonalizedISF(profile, currentGlucose);

  const insulinActivity = calculateInsulinActivity(totalHours, params);
  const maxGlucoseReduction = insulinDose * isf;
  const glucoseDrop = maxGlucoseReduction * insulinActivity;
  
  const basalChange = calculateBasalGlucoseChange(hours, profile, currentGlucose);
  
  // NEW: Add carb impact
  const carbImpact = calculateCarbImpact(
    latest.carbsConsumed ? parseFloat(latest.carbsConsumed) : 0,
    hours,
    profile
  );
  
  // NEW: Add activity impact
  const activityImpact = calculateActivityImpact(
    latest.recentActivity || 'none',
    hours
  );
  
  // NEW: Add factor impacts
  const factorImpact = calculateFactorImpacts(latest.factors || []);
  
  // Final prediction with all factors
  let predictedGlucose = currentGlucose - glucoseDrop + basalChange + carbImpact - activityImpact + factorImpact;
  predictedGlucose = Math.max(40, Math.round(predictedGlucose));

  const confidence = calculateConfidence(hoursElapsed, hours, profile, entries, latest);

  document.getElementById('predictedValue').textContent = predictedGlucose + ' mg/dL';
  
  let rangeText = '';
  if (predictedGlucose < 70) {
    rangeText = 'ðŸ”´ Low - Risk of hypoglycemia';
  } else if (predictedGlucose < 100) {
    rangeText = 'ðŸŸ¢ Normal - Good control';
  } else if (predictedGlucose < 140) {
    rangeText = 'ðŸŸ¡ Slightly elevated';
  } else if (predictedGlucose < 180) {
    rangeText = 'ðŸŸ  Elevated - Needs attention';
  } else {
    rangeText = 'ðŸ”´ High - Medical attention recommended';
  }
  
  const advice = generatePersonalizedAdvice(predictedGlucose, profile, latest);
  
  let personalizationNotes = [];
  if (profile.weight) personalizationNotes.push('weight');
  if (profile.exerciseLevel) personalizationNotes.push('activity level');
  if (profile.bmi) personalizationNotes.push('BMI');
  if (profile.conditions && profile.conditions.length > 0) personalizationNotes.push('medical conditions');
  
  let personalizationText = '';
  if (personalizationNotes.length > 0) {
    personalizationText = `<br><br><strong>Personalized factors:</strong> This prediction considers your ${personalizationNotes.join(', ')}.`;
  } else {
    personalizationText = '<br><br><em>ðŸ’¡ Tip: Complete your profile in Settings for more accurate predictions!</em>';
  }
  
  // Build factor breakdown
  let factorBreakdown = '<br><br><strong>Prediction Breakdown:</strong><br>';
  factorBreakdown += `â€¢ Starting glucose: ${currentGlucose} mg/dL<br>`;
  factorBreakdown += `â€¢ Insulin effect: -${glucoseDrop.toFixed(0)} mg/dL<br>`;
  factorBreakdown += `â€¢ Basal metabolic change: ${basalChange > 0 ? '+' : ''}${basalChange.toFixed(0)} mg/dL<br>`;
  
  if (carbImpact > 0) {
    factorBreakdown += `â€¢ Carbohydrate impact: +${carbImpact.toFixed(0)} mg/dL (${latest.carbsConsumed}g consumed)<br>`;
  }
  
  if (activityImpact > 0) {
    factorBreakdown += `â€¢ Activity impact: -${activityImpact.toFixed(0)} mg/dL (${latest.recentActivity} activity)<br>`;
  }
  
  if (factorImpact !== 0) {
    factorBreakdown += `â€¢ Other factors: ${factorImpact > 0 ? '+' : ''}${factorImpact.toFixed(0)} mg/dL<br>`;
    if (latest.factors && latest.factors.length > 0) {
      factorBreakdown += `  (${latest.factors.join(', ')})<br>`;
    }
  }
  
  let confidenceNote = '';
  if (hoursElapsed > 4) {
    confidenceNote = '<br><br><strong>âš ï¸ Note:</strong> This prediction is based on a reading from ' + 
                     hoursElapsed.toFixed(1) + ' hours ago. For better accuracy, take a new glucose reading with your meter.';
  }

  document.getElementById('predictionDetails').innerHTML = `
    <strong>${rangeText}</strong><br><br>
    ${advice}
    ${personalizationText}
    ${factorBreakdown}
    <br><strong>Prediction Confidence:</strong> ${confidence}%
    ${confidenceNote}<br><br>
    <em>âš ï¸ <strong>IMPORTANT:</strong> This is a mathematical estimate and should NOT replace blood glucose monitoring. Individual responses vary significantly. Always verify with your glucose meter and consult your healthcare provider before making any treatment decisions.</em>
  `;
  
  const resultDiv = document.getElementById('predictionResult');
  resultDiv.style.display = 'block';
  
  lucide.createIcons();
  
  resultDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
}

// Update statistics
function updateStats() {
  const entries = loadEntries();
  
  document.getElementById('totalEntries').textContent = entries.length;
  
  if (entries.length > 0) {
    const avg = entries.reduce((sum, e) => sum + parseFloat(e.currentGlucose), 0) / entries.length;
    document.getElementById('avgGlucose').textContent = Math.round(avg);
    
    const sorted = entries.sort((a, b) => {
      const dateA = new Date(a.date + 'T' + a.time);
      const dateB = new Date(b.date + 'T' + b.time);
      return dateB - dateA;
    });
    const lastDate = new Date(sorted[0].date + 'T' + sorted[0].time);
    const now = new Date();
    const diffMs = now - lastDate;
    const diffMins = Math.floor(diffMs / (1000 * 60));
    const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
    const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
    
    let timeText;
    if (diffMins < 1) {
      timeText = 'Just now';
    } else if (diffMins < 60) {
      timeText = diffMins + 'm ago';
    } else if (diffHours < 24) {
      timeText = diffHours + 'h ago';
    } else if (diffDays === 1) {
      timeText = '1 day ago';
    } else {
      timeText = diffDays + ' days ago';
    }
    
    document.getElementById('lastEntry').textContent = timeText;
  } else {
    document.getElementById('avgGlucose').textContent = '--';
    document.getElementById('lastEntry').textContent = '--';
  }
}

// Display log entries
function displayLogs() {
  const entries = loadEntries().sort((a, b) => {
    const dateA = new Date(a.date + 'T' + a.time);
    const dateB = new Date(b.date + 'T' + b.time);
    return dateB - dateA;
  });

  const listDiv = document.getElementById('logList');
  
  if (entries.length === 0) {
    listDiv.innerHTML = '<div class="empty-state">No entries logged yet. Add your first entry to get started!</div>';
    return;
  }

  let html = '';
  entries.forEach(entry => {
    let details = `Glucose: ${entry.currentGlucose} mg/dL | Insulin: ${entry.insulinDose} units (${entry.insulinType})`;
    
    if (entry.carbsConsumed) {
      details += ` | Carbs: ${entry.carbsConsumed}g`;
    }
    
    if (entry.recentActivity && entry.recentActivity !== 'none') {
      details += ` | Activity: ${entry.recentActivity}`;
    }
    
    if (entry.notes) {
      details += ` | ${entry.notes}`;
    }
    
    html += `
      <div class="log-item">
        <div class="log-info">
          <div class="log-time">${formatDateTime(entry.date, entry.time)}</div>
          <div class="log-details">${details}</div>
        </div>
        <div class="log-actions">
          <button class="icon-btn delete" onclick="deleteEntry('${entry.id}')">
            <i data-lucide="trash-2"></i>
          </button>
        </div>
      </div>
    `;
  });
  
  listDiv.innerHTML = html;
  lucide.createIcons();
}

// Delete entry
async function deleteEntry(id) {
  const confirmed = await showConfirm({
    title: 'Delete Entry?',
    message: 'Are you sure you want to delete this entry? This action cannot be undone.',
    type: 'warning',
    icon: '<i data-lucide="trash-2" style="width: 32px; height: 32px; color: #ef4444;"></i>',
    confirmText: 'Delete',
    confirmType: 'danger',
    cancelText: 'Cancel'
  });
  
  if (!confirmed) return;
  
  let entries = loadEntries();
  entries = entries.filter(e => e.id !== id);
  saveEntries(entries);
  
  displayLogs();
  updateStats();
  updateChart();
  
  window.dispatchEvent(new Event('storage'));
}

// Form submission
document.getElementById('glucoseForm').addEventListener('submit', function(e) {
  e.preventDefault();
  
  const currentGlucose = document.getElementById('currentGlucose').value;
  const insulinDose = document.getElementById('insulinDose').value;
  const insulinType = document.getElementById('insulinType').value;
  const logDate = document.getElementById('logDate').value;
  const logTime = document.getElementById('logTime').value;
  
  if (!currentGlucose || !insulinDose || !insulinType || !logDate || !logTime) {
    showAlert('Please fill in all required fields before saving.', 'warning', 'Missing Fields');
    return;
  }
  
  const glucoseValue = parseFloat(currentGlucose);
  if (isNaN(glucoseValue) || glucoseValue < 20 || glucoseValue > 600) {
    showAlert('Please enter a valid glucose level between 20 and 600 mg/dL.', 'error', 'Invalid Glucose Value');
    return;
  }
  
  const doseValue = parseFloat(insulinDose);
  if (isNaN(doseValue) || doseValue < 0 || doseValue > 100) {
    showAlert('Please enter a valid insulin dose between 0 and 100 units.', 'error', 'Invalid Insulin Dose');
    return;
  }
  
  // Collect factors
  const factors = [];
  if (document.getElementById('factorStress').checked) factors.push('stress');
  if (document.getElementById('factorIllness').checked) factors.push('illness');
  if (document.getElementById('factorMenstruation').checked) factors.push('menstruation');
  if (document.getElementById('factorAlcohol').checked) factors.push('alcohol');
  
  const entry = {
    id: generateId(),
    currentGlucose: currentGlucose,
    insulinDose: insulinDose,
    insulinType: insulinType,
    date: logDate,
    time: logTime,
    carbsConsumed: document.getElementById('carbsConsumed').value || null,
    recentActivity: document.getElementById('recentActivity').value || 'none',
    factors: factors,
    notes: document.getElementById('notes').value.trim()
  };
  
  const entries = loadEntries();
  entries.push(entry);
  saveEntries(entries);
  
  // Reset form
  this.reset();
  const now = new Date();
  document.getElementById('logDate').valueAsDate = now;
  document.getElementById('logTime').value = now.toTimeString().slice(0, 5);
  
  displayLogs();
  updateStats();
  updateChart();
  
  window.dispatchEvent(new Event('storage'));
  
  showAlert('Your glucose entry has been saved successfully!', 'success', 'Entry Saved');
  
  document.getElementById('logList').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
});

// Chart
let glucoseChart = null;

function updateChart() {
  const entries = loadEntries();
  
  const sevenDaysAgo = new Date();
  sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);
  
  const recentEntries = entries.filter(e => {
    const entryDate = new Date(e.date + 'T' + e.time);
    return entryDate >= sevenDaysAgo;
  }).sort((a, b) => {
    const dateA = new Date(a.date + 'T' + a.time);
    const dateB = new Date(b.date + 'T' + b.time);
    return dateA - dateB;
  });
  
  const labels = recentEntries.map(e => {
    const d = new Date(e.date + 'T' + e.time);
    return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric', hour: 'numeric' });
  });
  
  const data = recentEntries.map(e => parseFloat(e.currentGlucose));
  
  const ctx = document.getElementById('glucoseChart').getContext('2d');
  
  if (glucoseChart) {
    glucoseChart.destroy();
  }
  
  glucoseChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: labels,
      datasets: [{
        label: 'Blood Glucose (mg/dL)',
        data: data,
        borderColor: '#3b82f6',
        backgroundColor: 'rgba(59, 130, 246, 0.1)',
        tension: 0.4,
        fill: true,
        pointRadius: 5,
        pointHoverRadius: 7
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          display: true,
          position: 'top'
        },
        tooltip: {
          backgroundColor: 'rgba(0, 0, 0, 0.8)',
          padding: 12,
          titleFont: {
            size: 14,
            weight: 'bold'
          },
          bodyFont: {
            size: 13
          }
        }
      },
      scales: {
        y: {
          beginAtZero: false,
          min: 50,
          max: 250,
          grid: {
            color: 'rgba(0, 0, 0, 0.05)'
          },
          ticks: {
            callback: function(value) {
              return value + ' mg/dL';
            }
          }
        },
        x: {
          grid: {
            display: false
          }
        }
      }
    }
  });
}

// Export data as JSON
function exportData() {
  const entries = loadEntries();
  
  if (entries.length === 0) {
    showAlert('No data available to export. Please add some glucose entries first.', 'warning', 'No Data');
    return;
  }
  
  const dataStr = JSON.stringify(entries, null, 2);
  const dataBlob = new Blob([dataStr], { type: 'application/json' });
  const url = URL.createObjectURL(dataBlob);
  
  const link = document.createElement('a');
  link.href = url;
  link.download = `glucose-data-${new Date().toISOString().split('T')[0]}.json`;
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
  URL.revokeObjectURL(url);
  
  showAlert('Your glucose data has been exported successfully!', 'success', 'Export Complete');
}

// Clear all data
async function clearAllData() {
  const entries = loadEntries();
  
  if (entries.length === 0) {
    showAlert('No data to clear. Your glucose tracker is already empty.', 'info', 'No Data');
    return;
  }
  
  const confirmed = await showConfirm({
    title: 'âš ï¸ Delete All Data?',
    message: `This will permanently delete all ${entries.length} glucose entries. This action cannot be undone!`,
    type: 'error',
    icon: '<i data-lucide="alert-triangle" style="width: 32px; height: 32px; color: #ef4444;"></i>',
    confirmText: 'Yes, Delete All',
    confirmType: 'danger',
    cancelText: 'Cancel'
  });
  
  if (!confirmed) return;
  
  const doubleConfirm = await showConfirm({
    title: 'Final Confirmation',
    message: 'Are you absolutely sure? This is your last chance to cancel!',
    type: 'error',
    icon: '<i data-lucide="alert-octagon" style="width: 32px; height: 32px; color: #dc2626;"></i>',
    confirmText: 'Yes, Delete All',
    confirmType: 'danger',
    cancelText: 'No, Go Back'
  });
  
  if (!doubleConfirm) return;
  
  localStorage.removeItem('glucoseEntries');
  
  displayLogs();
  updateStats();
  updateChart();
  
  document.getElementById('predictionResult').style.display = 'none';
  
  window.dispatchEvent(new Event('storage'));
  
  showAlert('All glucose data has been cleared successfully.', 'success', 'Data Cleared');
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', () => {
  displayLogs();
  updateStats();
  updateChart();
  lucide.createIcons();
});

// Listen for storage events from other pages
window.addEventListener('storage', () => {
  displayLogs();
  updateStats();
  updateChart();
});
</script>


 </div>

 <!-- Custom Notification Modal -->
 <div id="customNotificationModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.6); z-index: 10000; justify-content: center; align-items: center; backdrop-filter: blur(8px); animation: fadeIn 0.3s ease;">
   <div id="customNotificationContent" style="background: white; padding: 40px; border-radius: 24px; box-shadow: 0 24px 80px rgba(0, 0, 0, 0.3); max-width: 500px; width: 90%; animation: scaleIn 0.3s cubic-bezier(0.4, 0, 0.2, 1); border: 2px solid #e2e8f0; text-align: center;">
     <div id="customNotificationIcon" style="margin: 0 auto 20px; width: 64px; height: 64px; border-radius: 50%; display: flex; align-items: center; justify-content: center;"></div>
     <h3 id="customNotificationTitle" style="color: #0f172a; margin-bottom: 16px; font-size: 1.5rem; font-weight: 800; letter-spacing: -0.02em;"></h3>
     <p id="customNotificationMessage" style="color: #64748b; font-size: 1rem; line-height: 1.6; margin-bottom: 28px; font-weight: 500;"></p>
     <div id="customNotificationButtons" style="display: flex; gap: 12px; justify-content: center;"></div>
   </div>
 </div>

 <style>
   @keyframes fadeIn {
     from { opacity: 0; }
     to { opacity: 1; }
   }
   
   @keyframes scaleIn {
     from {
       opacity: 0;
       transform: scale(0.9);
     }
     to {
       opacity: 1;
       transform: scale(1);
     }
   }
   
   .notification-btn {
     background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
     color: white;
     border: none;
     padding: 14px 32px;
     border-radius: 12px;
     cursor: pointer;
     font-weight: 700;
     font-size: 0.9375rem;
     transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
     box-shadow: 0 4px 12px rgba(30, 64, 175, 0.25);
     letter-spacing: -0.01em;
     font-family: 'Inter', sans-serif;
   }
   
   .notification-btn:hover {
     transform: translateY(-2px);
     box-shadow: 0 8px 20px rgba(30, 64, 175, 0.35);
   }
   
   .notification-btn:active {
     transform: translateY(0);
   }
   
   .notification-btn-secondary {
     background: #f1f5f9;
     color: #475569;
     box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
   }
   
   .notification-btn-secondary:hover {
     background: #e2e8f0;
     color: #1e293b;
     box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
   }
   
   .notification-btn-danger {
     background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
     color: white;
     box-shadow: 0 4px 12px rgba(220, 38, 38, 0.25);
   }
   
   .notification-btn-danger:hover {
     box-shadow: 0 8px 20px rgba(220, 38, 38, 0.35);
   }
   
   /* Dark theme support */
   html.dark-theme #customNotificationContent,
   body.dark-theme #customNotificationContent {
     background: #1e293b !important;
     border-color: #334155 !important;
   }
   
   html.dark-theme #customNotificationTitle,
   body.dark-theme #customNotificationTitle {
     color: #f8fafc !important;
   }
   
   html.dark-theme #customNotificationMessage,
   body.dark-theme #customNotificationMessage {
     color: #cbd5e1 !important;
   }
 </style>

 <script>
   // Initialize Lucide icons once
   lucide.createIcons();
   
   // Custom notification system
   window.showNotification = function(options) {
     const modal = document.getElementById('customNotificationModal');
     const content = document.getElementById('customNotificationContent');
     const icon = document.getElementById('customNotificationIcon');
     const title = document.getElementById('customNotificationTitle');
     const message = document.getElementById('customNotificationMessage');
     const buttons = document.getElementById('customNotificationButtons');
     
     // Set content
     title.textContent = options.title || 'Notification';
     message.textContent = options.message || '';
     
     // Set icon
     icon.innerHTML = '';
     const iconElement = document.createElement('div');
     iconElement.innerHTML = options.icon || '<i data-lucide="info" style="width: 32px; height: 32px;"></i>';
     icon.appendChild(iconElement);
     
     // Set icon background color
     const iconColors = {
       success: 'linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%)',
       error: 'linear-gradient(135deg, #fee2e2 0%, #fecaca 100%)',
       warning: 'linear-gradient(135deg, #fef3c7 0%, #fde68a 100%)',
       info: 'linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%)'
     };
     icon.style.background = iconColors[options.type] || iconColors.info;
     
     // Create buttons
     buttons.innerHTML = '';
     if (options.buttons && options.buttons.length > 0) {
       options.buttons.forEach(btn => {
         const button = document.createElement('button');
         button.textContent = btn.text;
         button.className = 'notification-btn';
         if (btn.type === 'secondary') button.classList.add('notification-btn-secondary');
         if (btn.type === 'danger') button.classList.add('notification-btn-danger');
         button.onclick = () => {
           modal.style.display = 'none';
           if (btn.onClick) btn.onClick();
         };
         buttons.appendChild(button);
       });
     } else {
       const okButton = document.createElement('button');
       okButton.textContent = 'OK';
       okButton.className = 'notification-btn';
       okButton.onclick = () => {
         modal.style.display = 'none';
         if (options.onClose) options.onClose();
       };
       buttons.appendChild(okButton);
     }
     
     // Show modal
     modal.style.display = 'flex';
     
     // Reinitialize Lucide icons
     lucide.createIcons();
   };
   
   // Custom confirm dialog
   window.showConfirm = function(options) {
     return new Promise((resolve) => {
       window.showNotification({
         title: options.title || 'Confirm',
         message: options.message || 'Are you sure?',
         type: options.type || 'warning',
         icon: options.icon || '<i data-lucide="alert-triangle" style="width: 32px; height: 32px; color: #f59e0b;"></i>',
         buttons: [
           {
             text: options.confirmText || 'Confirm',
             type: options.confirmType || 'primary',
             onClick: () => resolve(true)
           },
           {
             text: options.cancelText || 'Cancel',
             type: 'secondary',
             onClick: () => resolve(false)
           }
         ]
       });
     });
   };
   
   // Custom alert (for simple messages)
   window.showAlert = function(message, type = 'info', title = null) {
     const icons = {
       success: '<i data-lucide="check-circle" style="width: 32px; height: 32px; color: #22c55e;"></i>',
       error: '<i data-lucide="x-circle" style="width: 32px; height: 32px; color: #ef4444;"></i>',
       warning: '<i data-lucide="alert-triangle" style="width: 32px; height: 32px; color: #f59e0b;"></i>',
       info: '<i data-lucide="info" style="width: 32px; height: 32px; color: #3b82f6;"></i>'
     };
     
     const titles = {
       success: 'Success',
       error: 'Error',
       warning: 'Warning',
       info: 'Information'
     };
     
     window.showNotification({
       title: title || titles[type] || 'Notification',
       message: message,
       type: type,
       icon: icons[type] || icons.info
     });
   };
   
   const menuToggle = document.getElementById('menuToggle');
   const sidebar = document.getElementById('sidebar');
   const overlay = document.getElementById('sidebarOverlay');
   const navLinks = document.querySelectorAll('.nav-links a');

   function toggleSidebar() {
     sidebar.classList.toggle('open');
     overlay.classList.toggle('active');
     menuToggle.classList.toggle('active');
   }

   function closeSidebar() {
     sidebar.classList.remove('open');
     overlay.classList.remove('active');
     menuToggle.classList.remove('active');
   }

   menuToggle.addEventListener('click', toggleSidebar);
   overlay.addEventListener('click', closeSidebar);
   
   navLinks.forEach(link => {
     link.addEventListener('click', closeSidebar);
   });

   document.addEventListener('keydown', (e) => {
     if (e.key === 'Escape' && sidebar.classList.contains('open')) {
       closeSidebar();
     }
   });
 </script>
</body>
</html>
